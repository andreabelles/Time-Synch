function [pIMU, vIMU, pGNSS, xEKF, PEKF, xSkog, PSkog, vEKF, pEKF, biasAccEKF] = ...
                        simulateEstimations(p, tspan, Config)

%% Initializations

nPts    = length(tspan);        
measAcc = zeros(nPts,1);
measAccCorr = zeros(nPts,1);
vIMU    = zeros(nPts,1);    
vIMU(1) = Config.v0;
pIMU    = zeros(nPts,1);    
pIMU(1) = Config.p0;
pGNSS   = nan(nPts,1);

pEKF    = zeros(nPts,1);
pEKF(1) = Config.p0;
vEKF    = zeros(nPts,1);
vEKF(1) = Config.v0;
biasAccEKF = zeros(nPts,1);

% EKF parameters and initializations
xEKF        = zeros(3,nPts);
PEKF        = zeros(3,3,nPts);
PEKF(:,:,1) = [Config.sigmaPos^2 0 0; 0 Config.sigmaVel^2 0; 0 0 Config.sigmaAccBias^2];

% Integration IMU/GNSS parameters and initializations
% xEKF         = zeros(3,nPts);
% xEKF(1, 1)   = rp0;
% xEKF(2, 1)   = rv0;
% xEKF(3, 1)   = rba0;

PSkog        = zeros(4,4,nPts);
PSkog(:,:,1) = [Config.sigmaPos^2 0 0 0; ...
                0 Config.sigmaVel^2 0 0; ...
                0 0 Config.sigmaAccBias^2 0; ...
                0 0 0 Config.sigmaTd^2];
xSkog        = zeros(4,nPts);
xSkog(1, 1)  = Config.rp0;
xSkog(2, 1)  = Config.rv0;
xSkog(3, 1)  = Config.rba0;
xSkog(4, 1)  = Config.rt0;

for k = 2:1:nPts
    % IMU measurements generation
    measAcc(k) = Config.a0 + 0.01 + normrnd(0,Config.sigmaAcc);
    % GNSS measurements generation
    if mod(k,Config.M) == 0 && (k - Config.tDelay/Config.tIMU)>0
        pGNSS(k) = p(k - Config.tDelay/Config.tIMU) + normrnd(0,Config.sigmaGNSS);
    end
    % Strapdown equations
    vIMU(k) = vIMU(k-1) + measAcc(k)*Config.tIMU;
    pIMU(k) = pIMU(k-1) + vIMU(k)*Config.tIMU;

    %EKF
    [xEKF(:,k), PEKF(:,:,k), vEKF, pEKF, biasAccEKF, measAccCorr] = ...
                                  standardEKF(  xEKF(:,k-1),    ...
                                                PEKF(:,:,k-1),  ...
                                                pGNSS(k),       ...
                                                k,              ...
                                                measAcc,        ...
                                                measAccCorr,    ...
                                                pEKF, ...    
                                                vEKF, ...
                                                biasAccEKF,...
                                                Config.tIMU,           ...
                                                Config.sigmaAcc,       ...
                                                Config.sigmaGNSS, ...
                                                Config.sigmaAccBias);
    
%     [xSkog(:,k), PSkog(:,:,k), measAccCorr] = skogEKF(               ...
%                                                     xSkog,           ...
%                                                     PSkog,              ...
%                                                     pGNSS(k),           ...
%                                                     measAcc,            ...
%                                                     measAccCorr,        ...
%                                                     k,                  ...
%                                                     tspan,              ...
%                                                     tIMU,               ...                                                
%                                                     sigmaAcc,           ...
%                                                     sigmaGNSS);                                                
    % TODO: Lee and Johnson method
    
     
end


end